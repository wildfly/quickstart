/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-10-31
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var AeroGear={};AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,n,r=this[this.collectionName]||{};if(!e)return this;if(typeof e=="string")r[e]=AeroGear[this.lib].adapters[this.type](e);else if(AeroGear.isArray(e))for(t=0;t<e.length;t++)n=e[t],typeof n=="string"?r[n]=AeroGear[this.lib].adapters[this.type](n):r[n.name]=AeroGear[this.lib].adapters[n.type||this.type](n.name,n.settings||{});else r[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings||{});return this[this.collectionName]=r,this},this.remove=function(e){var t,n,r=this[this.collectionName]||{};if(typeof e=="string")delete r[e];else if(AeroGear.isArray(e))for(t=0;t<e.length;t++)n=e[t],typeof n=="string"?delete r[n]:delete r[n.name];else e&&delete r[e.name];return this[this.collectionName]=r,this}},function(e,t,n){e.ajax=function(n,r){var i=t.Deferred(function(){var i=this,s=t.extend({},{contentType:"application/json",dataType:"json"},r);this.done(s.success),this.fail(s.error),this.always(s.complete);var o=t.extend({},s,{success:function(e,t,n){i.resolve(typeof e=="string"&&o.dataType==="json"?JSON.parse(e):e,t,n)},error:function(e,t,n){if(o.dataType==="json")try{e.responseJSON=JSON.parse(e.responseText)}catch(r){}i.reject(e,t,n)},complete:function(e,t){i.resolve(e,t)}});o.contentType==="application/json"&&o.data&&(o.type==="POST"||o.type==="PUT")&&(o.data=JSON.stringify(o.data)),e.Auth&&!n.isAuthenticated()?this.reject("auth","Error: Authentication Required"):n.addAuthIdentifier?t.ajax(n.addAuthIdentifier(o)):t.ajax(o)}),s=i.promise();return s.success=i.done,s.error=i.fail,s.complete=i.always,s},e.isArray=function(e){return{}.toString.call(e)==="[object Array]"}}(AeroGear,jQuery),function(e,t,n){e.Pipeline=function(t){if(!(this instanceof e.Pipeline))return new e.Pipeline(t);e.Core.call(this),this.lib="Pipeline",this.type=t?t.type||"Rest":"Rest",this.collectionName="pipes",this.add(t)},e.Pipeline.prototype=e.Core,e.Pipeline.constructor=e.Pipeline,e.Pipeline.adapters={}}(AeroGear,jQuery),function(e,t,n){e.Pipeline.adapters.Rest=function(t,n){if(!(this instanceof e.Pipeline.adapters.Rest))return new e.Pipeline.adapters.Rest(t,n);n=n||{};var r=n.endpoint||t,i={url:n.baseURL?n.baseURL+r:r},s=n.recordId||"id",o=n.authenticator||null,u="Rest";this.isAuthenticated=function(){return o?o.isAuthenticated():!0},this.addAuthIdentifier=function(e){return o?o.addAuthIdentifier(e):e},this.deauthorize=function(){o&&o.deauthorize()},this.getAjaxSettings=function(){return i},this.getRecordId=function(){return s}},e.Pipeline.adapters.Rest.prototype.read=function(n){var r=this,i=this.getRecordId(),s=this.getAjaxSettings(),o,u,a,f;return n=n||{},n[i]?o=s.url+"/"+n[i]:o=s.url,u=function(t){var r=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.success&&n.success.apply(this,arguments)},a=function(t,r){var i=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();n.error&&n.error.apply(this,arguments)},f={type:"GET",success:u,error:a,url:o,statusCode:n.statusCode,complete:n.complete},e.ajax(this,t.extend({},this.getAjaxSettings(),f))},e.Pipeline.adapters.Rest.prototype.save=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u,a,f,l,c;return n=n||{},r=r||{},u=n[s]?"PUT":"POST",n[s]?a=o.url+"/"+n[s]:a=o.url,f=function(t){var n=e.isArray(r.stores)?r.stores:[r.stores],i;if(r.stores)for(i in n)n[i].save(t);r.success&&r.success.apply(this,arguments)},l=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},c={data:n,type:u,url:a,success:f,error:l,statusCode:r.statusCode,complete:r.complete},e.ajax(this,t.extend({},o,c))},e.Pipeline.adapters.Rest.prototype.remove=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u="",a,f,l,c,h;return typeof n=="string"||typeof n=="number"?a=n:n&&n[s]?a=n[s]:n&&!r&&(r=n),r=r||{},u=a?"/"+a:"",f=o.url+u,l=function(t){var n,i;if(r.stores){n=e.isArray(r.stores)?r.stores:[r.stores];for(i in n)n[i].remove(a)}r.success&&r.success.apply(this,arguments)},c=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},h={type:"DELETE",url:f,success:l,error:c,statusCode:r.statusCode,complete:r.complete},e.ajax(this,t.extend({},o,h))}}(AeroGear,jQuery),function(e,t,n){e.DataManager=function(t){if(!(this instanceof e.DataManager))return new e.DataManager(t);e.Core.call(this),this.lib="DataManager",this.type=t?t.type||"Memory":"Memory",this.collectionName="stores",this.add(t)},e.DataManager.prototype=e.Core,e.DataManager.constructor=e.DataManager,e.DataManager.adapters={},e.DataManager.STATUS_NEW=1,e.DataManager.STATUS_MODIFIED=2,e.DataManager.STATUS_REMOVED=0}(AeroGear,jQuery),function(e,t,n,r){e.DataManager.adapters.Memory=function(t,r){if(!(this instanceof e.DataManager.adapters.Memory))return new e.DataManager.adapters.Memory(t,r);r=r||{};var i=r.recordId?r.recordId:"id",s="Memory",o=null,u=!!r.dataSync;this.getRecordId=function(){return i},this.getData=function(t){var n=[],r,i;if(u&&!t){for(r in o)i=o[r]["ag-sync-status"],i!==e.DataManager.STATUS_REMOVED&&n.push(o[r]);return n}return o},this.setData=function(t){if(u)for(var n in t)t[n]["ag-sync-status"]=e.DataManager.STATUS_NEW;o=t},this.emptyData=function(){if(u)for(var t in o)o[t]["ag-sync-status"]=e.DataManager.STATUS_REMOVED;else o=null},this.addDataRecord=function(t){o=o||[],u&&(t["ag-sync-status"]=e.DataManager.STATUS_NEW,t.id=t.id||n.v4()),o.push(t)},this.updateDataRecord=function(t,n){u&&(n["ag-sync-status"]=e.DataManager.STATUS_MODIFIED),o[t]=n},this.removeDataRecord=function(t){u?o[t]["ag-sync-status"]=e.DataManager.STATUS_REMOVED:o.splice(t,1)},this.getDataSync=function(){return u}},e.DataManager.adapters.Memory.prototype.read=function(e){var t={};return t[this.getRecordId()]=e,e?this.filter(t):this.getData()},e.DataManager.adapters.Memory.prototype.save=function(t,n){var r=!1;t=e.isArray(t)?t:[t];if(n)this.setData(t);else if(this.getData())for(var i=0;i<t.length;i++){for(var s in this.getData())if(this.getData()[s][this.getRecordId()]===t[i][this.getRecordId()]){this.updateDataRecord(s,t[i]),r=!0;break}r||this.addDataRecord(t[i]),r=!1}else this.setData(t);return this.getData()},e.DataManager.adapters.Memory.prototype.remove=function(t){if(!t)return this.emptyData(),this.getData();t=e.isArray(t)?t:[t];var n,r,i;for(var s=0;s<t.length;s++){if(typeof t[s]=="string"||typeof t[s]=="number")n=t[s];else{if(!t)continue;n=t[s][this.getRecordId()]}r=this.getData(!0);for(i in r)r[i][this.getRecordId()]===n&&this.removeDataRecord(i)}return this.getData()},e.DataManager.adapters.Memory.prototype.filter=function(n,r){var i,s,o,u;return n?(i=this.getData().filter(function(i,a,f){var l=r?!1:!0,c=Object.keys(n),h,p,d;for(s=0;s<c.length;s++){if(n[c[s]].data){h=n[c[s]],d=h.matchAny?!1:!0;for(o=0;o<h.data.length;o++)if(e.isArray(i[c[s]]))if(i[c[s]].length){if(t(i[c]).not(h.data).length===0&&t(h.data).not(i[c]).length===0){d=!0;break}for(u=0;u<i[c[s]].length;u++){if(h.matchAny&&h.data[o]===i[c[s]][u]){d=!0;break}if(!h.matchAny&&h.data[o]!==i[c[s]][u]){d=!1;break}}}else d=!1;else{if(h.matchAny&&h.data[o]===i[c[s]]){d=!0;break}if(!h.matchAny&&h.data[o]!==i[c[s]]){d=!1;break}}}else if(e.isArray(i[c[s]])){d=r?!1:!0;if(i[c[s]].length)for(o=0;o<i[c[s]].length;o++){if(r&&n[c[s]]===i[c[s]][o]){d=!0;break}if(!r&&n[c[s]]!==i[c[s]][o]){d=!1;break}}else d=!1}else d=n[c[s]]===i[c[s]]?!0:!1;if(r&&d){l=!0;break}if(!r&&!d){l=!1;break}}return l}),i):(i=this.getData()||[],i)}}(AeroGear,jQuery,window.uuid),function(e,t,n){e.Auth=function(t){if(!(this instanceof e.Auth))return new e.Auth(t);e.Core.call(this),this.lib="Auth",this.type=t?t.type||"Rest":"Rest",this.collectionName="modules",this.add(t)},e.Auth.prototype=e.Core,e.Auth.constructor=e.Auth,e.Auth.adapters={}}(AeroGear,jQuery),function(e,t,n){e.Auth.adapters.Rest=function(n,r){if(!(this instanceof e.Auth.adapters.Rest))return new e.Auth.adapters.Rest(n,r);r=r||{};var i=r.endpoints||{},s="Rest",o=n,u=!!r.agAuth,a=r.baseURL,f=r.tokenName||"Auth-Token";this.isAuthenticated=function(){return u?!!sessionStorage.getItem("ag-auth-"+o):!0},this.addAuthIdentifier=function(e){return e.headers={},e.headers[f]=sessionStorage.getItem("ag-auth-"+o),t.extend({},e)},this.deauthorize=function(){sessionStorage.removeItem("ag-auth-"+o)},this.getSettings=function(){return r},this.getEndpoints=function(){return i},this.getName=function(){return o},this.getAGAuth=function(){return u},this.getBaseURL=function(){return a},this.getTokenName=function(){return f}},e.Auth.adapters.Rest.prototype.enroll=function(e,n){n=n||{};var r=this,i=this.getName(),s=this.getTokenName(),o=this.getBaseURL(),u=this.getEndpoints(),a=this.getAGAuth(),f=function(e,t,o){sessionStorage.setItem("ag-auth-"+i,r.getAGAuth()?o.getResponseHeader(s):"true"),n.success&&n.success.apply(this,arguments)},l=function(e,t,r){var i;try{e.responseJSON=JSON.parse(e.responseText),i=[e,t,r]}catch(s){i=arguments}n.error&&n.error.apply(this,i)},c={success:f,error:l,data:e},h="";return n.contentType?c.contentType=n.contentType:a&&(c.contentType="application/json"),n.dataType?c.dataType=n.dataType:a&&(c.dataType="json"),n.baseURL?h=n.baseURL:o&&(h=o),u.enroll?h+=u.enroll:h+="auth/enroll",h.length&&(c.url=h),t.ajax(t.extend({},this.getSettings(),{type:"POST"},c))},e.Auth.adapters.Rest.prototype.login=function(e,n){n=n||{};var r=this,i=this.getName(),s=this.getTokenName(),o=this.getBaseURL(),u=this.getEndpoints(),a=this.getAGAuth(),f=function(e,t,o){sessionStorage.setItem("ag-auth-"+i,r.getAGAuth()?o.getResponseHeader(s):"true"),n.success&&n.success.apply(this,arguments)},l=function(e,t,r){var i;try{e.responseJSON=JSON.parse(e.responseText),i=[e,t,r]}catch(s){i=arguments}n.error&&n.error.apply(this,i)},c={success:f,error:l,data:e},h="";return n.contentType?c.contentType=n.contentType:a&&(c.contentType="application/json"),n.dataType?c.dataType=n.dataType:a&&(c.dataType="json"),n.baseURL?h=n.baseURL:o&&(h=o),u.login?h+=u.login:h+="auth/login",h.length&&(c.url=h),t.ajax(t.extend({},this.getSettings(),{type:"POST"},c))},e.Auth.adapters.Rest.prototype.logout=function(e){e=e||{};var n=this,r=this.getName(),i=this.getTokenName(),s=this.getBaseURL(),o=this.getEndpoints(),u=function(t,r,i){n.deauthorize(),e.success&&e.success.apply(this,arguments)},a=function(t,n,r){var i;try{t.responseJSON=JSON.parse(t.responseText),i=[t,n,r]}catch(s){i=arguments}e.error&&e.error.apply(this,i)},f={success:u,error:a},l="";return e.baseURL?l=e.baseURL:s&&(l=s),o.logout?l+=o.logout:l+="auth/logout",l.length&&(f.url=l),this.isAuthenticated()&&(f.headers={},f.headers[i]=sessionStorage.getItem("ag-auth-"+r)),t.ajax(t.extend({},this.getSettings(),{type:"POST"},f))}}(AeroGear,jQuery);